# 从零开始：新手必懂的权限控制基础与实战

## 权限需求的自然演进：从“单一”到“复杂”的必然路径

权限控制，本质是对用户访问系统资源的范围与操作边界进行界定，决定了 “**谁能做什么**” 和 “**谁不能做什么**”，是保障系统数据安全与有序运行的核心机制。权限控制的演变主要经历了一下几个阶段：

#### 1. 从 “裸奔” 开始：单一用户的初始状态

几乎所有项目的起步阶段，都绕不开 “**单一用户**” 模式。

- 此时系统只有一个操作账号，通常由开发者或项目负责人直接使用。
- 该账号拥有最高权限，能查看所有数据、修改核心配置、删除关键信息，不存在任何访问限制。

这种模式的优势是简单高效，适合项目初期快速开发与测试，但一旦系统投入实际使用，数据安全风险会瞬间放大。

#### 2. 首次升级：管理员与普通用户的二分模型

当项目需要多人协作或面向外部用户时，“单一用户” 模式的弊端会立刻显现，最简单的 “**管理员 - 普通用户**” 二分模型便成为首选解决方案。

- **管理员角色**：保留系统最高权限，负责全局管理。核心操作包括创建 / 删除用户账号、配置系统参数、审核数据内容、处理异常问题等，是系统的 “掌控者”。
- **普通用户角色**：权限被严格限定在业务需求范围内。通常只能查看自己有权访问的数据、提交符合规则的操作（如修改个人信息、提交业务表单），无法触碰系统核心配置或他人敏感数据，是系统的 “使用者”。

这一模型通过 “分工明确” 解决了 “谁能做关键操作、谁只能做基础操作” 的问题，是权限控制体系的基础雏形。

#### 3. 向精细化演进：从 “二分” 到多角色、多维度控制

随着系统复杂度提升，二分模型会逐渐无法满足需求，权限控制会向更精细的方向发展。

- **多角色拆分**：在管理员与普通用户之间，拆分出 “运营角色”“审核角色”“客服角色” 等。例如运营可管理活动数据，审核员仅能审核内容，客服只能查看用户咨询记录，实现 “专人专权”。
- **多维度控制**：从 “角色” 维度延伸到 “数据范围”“操作类型” 维度。比如同样是 “普通用户”，A 用户只能查看自己的订单，B 用户（如部门主管）能查看团队所有订单；同样是 “查看” 权限，部分用户可导出数据，部分用户仅能在线浏览。

以电商系统为例，不同角色可以进行的操作、可以访问的数据都是不同的：

| 角色           | 可访问数据范围                                               | 可执行核心操作                                               |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **超级管理员** | 全系统数据（含用户隐私数据、财务数据、系统日志）             | 1. 增删改所有角色账号及权限配置2. 查看 / 导出财务流水、订单总数据3. 修改系统核心参数（如支付接口、物流配置）4. 冻结 / 解封任意用户账号 |
| **运营专员**   | 1. 商品全信息（库存、定价、详情）2. 全量订单数据（不含用户银行卡信息）3. 营销活动数据（参与人数、转化量） | 1. 上架 / 下架 / 编辑商品信息2. 创建 / 修改 / 终止营销活动（如优惠券、满减）3. 导出订单数据用于分析4. 处理订单异常（如修改收货地址、备注） |
| **客服专员**   | 1. 本人接待的用户咨询记录2. 对应用户的订单基础信息（商品、金额、物流状态）3. 常见问题知识库 | 1. 回复用户咨询、处理售后请求（如退换货申请）2. 为用户查询订单物流状态3. 向运营 / 管理员反馈用户问题，无修改数据权限 |
| **普通用户**   | 1. 本人账号信息（昵称、收货地址、绑定手机）2. 本人历史订单、购物车、收藏夹3. 公开商品信息（不含后台库存、成本价） | 1. 修改本人账号信息、管理收货地址2. 下单、支付、申请退换货、评价订单3. 收藏 / 加购商品，无任何后台操作权限 |

同时由于系统权限需求的动态变化是必然趋势，随着用户量的增加，权限也会变得复杂，因此我们在设计权限系统时，要考虑到系统的可扩展性，以应对日后的挑战。接下来和我一起，从零开始设计一套权限控制系统吧！



## **权限控制的设计思路与实战探索（一个小实习生视角）**

> **一个从实习生到正式员工都要用的内部文档（如x雀、x书）系统，是如何逼着我们一步步升级权限体系的？**

假设我们的平台叫：**DocuFlow 企业内部文档管理平台**

主要用于公司内部的：项目文档、周报/月报、部门资料、规章制度、代码规范、财务资料（敏感）等。

使用人群：实习生、普通员工、部门主管、人事、财务、管理员（IT）等。

### ⭐ **2.1 需求背景：DocuFlow 的起点（一个实习生的体验）**
我是一个刚入职的实习生，公司让我访问内部文档系统 DocuFlow。

打开后，我惊呆了：

> “我居然能看到财务报表？还能删除规范文档？？？
> 我只是个实习生啊！！！”

因为 DocuFlow 初期只有一个超级管理员账号，所有功能没有权限限制。

这也几乎是所有系统的真实起点：**能跑就行，权限以后再说。**

但很快——灾难出现了。

------

### ⭐ **2.2 第一阶段：没有权限控制的混乱（灾难初现）**

某天，一位实习生要修改自己项目资料里的一个 Markdown 文档，结果误把整个“部门规范”目录删掉了。

> 第二天，全公司几十号人一边骂一边重写规范。

这时团队意识到：

**必须至少区分管理员和普通员工，不然系统会变成「大型事故制造机」。**

------

### ⭐ **2.3 第二阶段：管理员 / 普通员工（二分模型）**

#### **需求演进：**

- 管理员（IT）可以管理目录、文档、用户
- 普通员工只能查看和编辑属于自己的文档，不允许删除核心资料

这样做至少防止实习生删库跑路了。

------

#### **2.3.1 数据结构（最简单的角色字段）**

```mysql
ALTER TABLE user ADD COLUMN role VARCHAR(20);  
-- role: ADMIN / USER
```

------

#### **2.3.2 Spring Security 实现（二分逻辑）**

```java
.authorizeHttpRequests(auth -> auth
    .requestMatchers("/admin/**").hasRole("ADMIN")
    .anyRequest().authenticated()
)
```

只要不是管理员，就不能访问 `/admin` 下的接口。

------

❗ **现实问题出现：**

随着公司扩张，两个角色根本不够用。

- 人事需要能看所有员工的绩效文档，但不能看项目文档

- 财务只能查看财务资料

- 主管需要能查看下属的所有文档

- 实习生只能看自己创建的文档

很明显：二分法的权限已经崩溃。

**于是我们进入下一阶段。**

------

### ⭐ **2.4 第三阶段：多角色权限（标准 RBAC）**

#### **新需求：**

- 人事（HR）：可以查看员工档案、绩效文档
- 财务（Finance）：可以访问财务资料
- 部门主管（Manager）：查看本部门文档
- 普通员工（Staff）：只能访问自己有权限的文档

此时必须引入 RBAC：

**用户 → 多个角色 → 每个角色包含多个权限**

------

#### **2.4.1 数据库（标准 RBAC 模型）**

```mysql
CREATE TABLE role(
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50),
    code VARCHAR(50) UNIQUE
);

CREATE TABLE permission(
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(100) UNIQUE,
    description VARCHAR(200)
);

CREATE TABLE user_role(
    user_id BIGINT,
    role_id BIGINT,
    PRIMARY KEY(user_id, role_id)
);

CREATE TABLE role_permission(
    role_id BIGINT,
    permission_id BIGINT,
    PRIMARY KEY(role_id, permission_id)
);
```

示例权限：

- DOC_VIEW
- DOC_EDIT
- DOC_DELETE
- FILE_UPLOAD
- USER_MANAGE

------

#### **2.4.2 Spring Security 权限加载**

```java
List<String> permissions = permissionMapper.findByUserId(userId);
```

并绑定到用户：

```java
new UsernamePasswordAuthenticationToken(
    user, null, authorities // 权限列表
);
```

------

#### **2.4.3 Vue 前端的动态菜单渲染**

```vue
const userPermissions = store.user.permissions;

<div v-if="userPermissions.includes('DOC_EDIT')">
  <button>编辑文档</button>
</div>
```

------

##### ❗ 现实问题继续出现：

1. **角色越来越多（角色爆炸）**
   - 人事（HR）
   - HR主管
   - HR专员
   - 财务
   - 财务主管
   - 技术部主管
   - 技术部员工
   - …
2. **同角色但不同权限的情况不断出现**
   - 新来的实习生只给 1/3 权限
   - 部门主管 A 可以看财务报表
   - 部门主管 B 不可以看财务报表

RBAC 继续撑不动了。

下一步：更细粒度。

------

### ⭐ **2.5 第四阶段：细粒度权限控制（ABAC）**

场景变复杂了：

##### **案例 1：部门级访问控制（数据级权限）**

主管应该只能查看“自己部门”的员工文档。
 HR 需要能跨部门查看所有员工文档。

##### **案例 2：字段级权限控制**

普通员工可以查看工资条，但**看不到金额**。
 财务可以查看完整信息。

##### **案例 3：行为级控制**

实习生可以编辑、但不能删除文档。

------

#### **引入 ABAC（基于属性的访问控制）**

权限不再由“角色”决定，而是由属性决定：

- 用户属性：
   部门 / 岗位 / 职级 / 是否实习生
- 文档属性：
   所属部门 / 文档类型（制度、财务、绩效）
- 环境属性：
   操作时间 / IP / 是否敏感操作

------

#### **2.5.1 ABAC 示例：文档访问判断**

```java
boolean hasAccess(Document doc, User user) {
    if (user.getRole().equals("ADMIN")) return true;

    // 用户只能查看自己部门的文档
    if (doc.getDepartment().equals(user.getDepartment())) {
        return true;
    }

    // HR 可以查看所有文档类型
    if (user.getPosition().equals("HR")) {
        return true;
    }

    return false;
}
```

ABAC 让逻辑更加灵活。

------

#### ❗ ABAC 也不完美

- 随着规则变多，判断逻辑会越来越难维护
- 开发人员难以统一编写规则
- 新需求很容易写爆 if/else

所以大厂常采用混合方案：

------

### ⭐ **2.6 第五阶段：大厂级权限体系（RBAC + ABAC + ACL）**

成熟企业（如字节、腾讯、阿里）几乎都采用：

- **RBAC 管控菜单/功能模块（粗粒度）**
- **ABAC 管控数据文档可见性（细粒度）**
- **ACL（Access Control List）处理特殊授权**
   如：临时给总监访问某个部门的资料

完整判断链：

1. **你是否有该模块权限？（RBAC）**
2. **你是否能访问这份文档？（ABAC）**
3. **是否有特殊授权？（ACL）**

示例 ACL 表：

```mysql
acl(id, user_id, doc_id, allow BOOLEAN)
```

用来单独给某个用户授权某个文档。

------

### ⭐ 最终总结：为什么权限会变这么复杂？

因为业务不断逼迫我们：

- 用户越来越多
- 角色越来越多
- 数据越来越敏感
- 操作越来越精细
- 权限需求越来越灵活

最终演变为：

> **RBAC（模块级） + ABAC（数据级） + ACL（特例级）
>  三者混合成为企业级标准权限体系。**